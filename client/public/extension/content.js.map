{
  "version": 3,
  "sources": ["../../../extension_src/content.ts"],
  "sourcesContent": ["// Segnala la presenza dell'estensione alla pagina web tramite attributo DOM\n// Pi\u00F9 sicuro e compatibile con le CSP restrittive\ndocument.documentElement.setAttribute('data-gromit-bridge-active', 'true');\nconsole.log('[GromitBridge] Content Script inizializzato.');\n\n// --- SESSION LIFECYCLE MANAGEMENT ---\n// Establish a long-lived connection to keep the extension context alive (and detect closure)\nconst sessionPort = chrome.runtime.connect({ name: \"GROMIT_SESSION\" });\n\n// In ascolto di eventi dalla pagina web\nwindow.addEventListener('GROMIT_BRIDGE_REQUEST', (event: any) => {\n    const { detail, requestId } = event.detail;\n\n    // Helper to send message with optional retry\n    const sendWithRetry = (retry = true) => {\n        try {\n            chrome.runtime.sendMessage(detail, (response) => {\n                if (chrome.runtime.lastError) {\n                    const error = chrome.runtime.lastError.message;\n                    console.warn(`[GromitBridge] Message error: ${error}`);\n\n                    if (retry && error?.includes('Could not establish connection')) {\n                        console.log('[GromitBridge] Retrying message in 500ms...');\n                        setTimeout(() => sendWithRetry(false), 500);\n                        return;\n                    }\n\n                    // Respond with error if no retry or other error\n                    window.dispatchEvent(new CustomEvent('GROMIT_BRIDGE_RESPONSE', {\n                        detail: { response: { success: false, error }, requestId }\n                    }));\n                    return;\n                }\n\n                // Success: Restituisce la risposta alla pagina web\n                window.dispatchEvent(new CustomEvent('GROMIT_BRIDGE_RESPONSE', {\n                    detail: { response, requestId }\n                }));\n            });\n        } catch (err: any) {\n            console.error('[GromitBridge] Send Exception:', err);\n            window.dispatchEvent(new CustomEvent('GROMIT_BRIDGE_RESPONSE', {\n                detail: { response: { success: false, error: err.message }, requestId }\n            }));\n        }\n    };\n\n    sendWithRetry();\n});\n\nconsole.log('[GromitBridge] Content Script attivo e pronto. Session Port aperta.');\n"],
  "mappings": ";AAEA,SAAS,gBAAgB,aAAa,6BAA6B,MAAM;AACzE,QAAQ,IAAI,8CAA8C;AAI1D,IAAM,cAAc,OAAO,QAAQ,QAAQ,EAAE,MAAM,iBAAiB,CAAC;AAGrE,OAAO,iBAAiB,yBAAyB,CAAC,UAAe;AAC7D,QAAM,EAAE,QAAQ,UAAU,IAAI,MAAM;AAGpC,QAAM,gBAAgB,CAAC,QAAQ,SAAS;AACpC,QAAI;AACA,aAAO,QAAQ,YAAY,QAAQ,CAAC,aAAa;AAC7C,YAAI,OAAO,QAAQ,WAAW;AAC1B,gBAAM,QAAQ,OAAO,QAAQ,UAAU;AACvC,kBAAQ,KAAK,iCAAiC,KAAK,EAAE;AAErD,cAAI,SAAS,OAAO,SAAS,gCAAgC,GAAG;AAC5D,oBAAQ,IAAI,6CAA6C;AACzD,uBAAW,MAAM,cAAc,KAAK,GAAG,GAAG;AAC1C;AAAA,UACJ;AAGA,iBAAO,cAAc,IAAI,YAAY,0BAA0B;AAAA,YAC3D,QAAQ,EAAE,UAAU,EAAE,SAAS,OAAO,MAAM,GAAG,UAAU;AAAA,UAC7D,CAAC,CAAC;AACF;AAAA,QACJ;AAGA,eAAO,cAAc,IAAI,YAAY,0BAA0B;AAAA,UAC3D,QAAQ,EAAE,UAAU,UAAU;AAAA,QAClC,CAAC,CAAC;AAAA,MACN,CAAC;AAAA,IACL,SAAS,KAAU;AACf,cAAQ,MAAM,kCAAkC,GAAG;AACnD,aAAO,cAAc,IAAI,YAAY,0BAA0B;AAAA,QAC3D,QAAQ,EAAE,UAAU,EAAE,SAAS,OAAO,OAAO,IAAI,QAAQ,GAAG,UAAU;AAAA,MAC1E,CAAC,CAAC;AAAA,IACN;AAAA,EACJ;AAEA,gBAAc;AAClB,CAAC;AAED,QAAQ,IAAI,qEAAqE;",
  "names": []
}
